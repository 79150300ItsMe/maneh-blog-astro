---
import { slugifyTag, getTagUrl, isTagMatch } from '../../lib/slug';

// Import articles data - this should match the data in public/js/data.js
// Using actual data from the blog
const ARTICLES = [
  {
    slug: "setup-vscode-web-development-panduan-lengkap",
    published: "2025-01-22",
    category: "tutorial",
    title: "Setup VSCode untuk Web Development: Panduan Lengkap 2025",
    tags: ["VSCode", "Web Development", "Setup", "Tutorial", "Tools"],
    cover: "https://images.unsplash.com/photo-1517180102446-f3ece451e9d8?w=800&q=80&auto=format",
    minutes: 12,
    summary: "Panduan lengkap setup VSCode untuk web development dengan extension terbaik, settings optimal, dan workflow produktif untuk developer modern.",
    alt: "Antarmuka VSCode untuk web development",
    links: ["cara-membuat-website-dengan-chatgpt-ai-tools", "panduan-lengkap-belajar-python-untuk-pemula", "panduan-karir-developer-2025"]
  },
  {
    slug: "cara-membuat-website-dengan-chatgpt-ai-tools",
    published: "2025-01-23",
    category: "tutorial",
    title: "Cara Membuat Website dengan ChatGPT & AI Tools (2025)",
    tags: ["ChatGPT", "AI Tools", "Web Development", "Tutorial", "Website"],
    cover: "https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80&auto=format",
    minutes: 8,
    summary: "Panduan step-by-step membuat website profesional menggunakan ChatGPT dan AI tools modern. Dari konsep hingga deployment dengan bantuan kecerdasan buatan.",
    alt: "ChatGPT dan AI tools untuk pembuatan website",
    links: ["setup-vscode-web-development-panduan-lengkap", "panduan-lengkap-belajar-python-untuk-pemula", "panduan-karir-developer-2025"]
  },
  {
    slug: "optimasi-chatgpt-panduan-prompts",
    published: "2025-09-19",
    category: "tutorial",
    title: "Cara Optimasi ChatGPT: Panduan Prompts Terbaik",
    tags: ["AI", "ChatGPT", "Prompt Engineering"],
    cover: "https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=800&q=80&auto=format",
    minutes: 18,
    summary: "Panduan lengkap optimasi ChatGPT dengan prompts yang efektif. Tips dan trik menghasilkan respons AI yang lebih akurat dan relevan.",
    alt: "ChatGPT interface dan prompt optimization",
    links: ["cara-membuat-website-dengan-chatgpt-ai-tools", "era-baru-sinema-ai-sora", "panduan-karir-developer-2025"]
  },
  {
    slug: "era-baru-sinema-ai-sora",
    published: "2025-09-25",
    category: "news",
    title: "AI Sora: Revolusi Video Generation 2025",
    tags: ["AI", "Sora", "Generative Video", "Teknologi"],
    cover: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&h=630&auto=format&fit=crop&crop=center",
    minutes: 18,
    summary: "Analisis mendalam dampak AI Sora pada industri film dan content creation. Bagaimana kecerdasan buatan mengubah cara kita membuat video.",
    alt: "Tampilan AI Sora untuk video generation",
    links: ["cara-membuat-website-dengan-chatgpt-ai-tools", "optimasi-chatgpt-panduan-prompts", "dampak-jangka-panjang-remote-work"]
  },
  {
    slug: "panduan-lengkap-belajar-python-untuk-pemula",
    published: "2025-01-26",
    category: "tutorial",
    title: "Panduan Lengkap Belajar Python untuk Pemula",
    tags: ["Python", "Programming", "Tutorial", "Pemula", "AI"],
    cover: "https://images.unsplash.com/photo-1526379095098-d400fd0bf935?w=800&q=80&auto=format",
    minutes: 20,
    summary: "Panduan komprehensif belajar Python dari dasar hingga mahir, cocok untuk pemula yang ingin memulai karir programming.",
    alt: "Belajar Python untuk pemula",
    links: ["setup-vscode-web-development-panduan-lengkap", "cara-membuat-website-dengan-chatgpt-ai-tools", "panduan-karir-developer-2025"]
  },
  {
    slug: "panduan-lengkap-setup-home-office-remote-work",
    published: "2025-01-24",
    category: "tutorial",
    title: "Panduan Lengkap Setup Home Office untuk Remote Work",
    tags: ["Remote Work", "Home Office", "Produktivitas", "WFH", "Ergonomis"],
    cover: "https://images.unsplash.com/photo-1486946255434-2466348c2166?w=800&q=80&auto=format",
    minutes: 15,
    summary: "Panduan lengkap setup home office yang ergonomis dan produktif untuk remote work. Tips memaksimalkan produktivitas di rumah.",
    alt: "Setup home office untuk remote work",
    links: ["setup-vscode-web-development-panduan-lengkap", "panduan-lengkap-belajar-python-untuk-pemula", "panduan-karir-developer-2025"]
  },
  {
    slug: "tutorial-lengkap-membuat-aplikasi-mobile-flutter",
    published: "2025-01-25",
    category: "tutorial",
    title: "Tutorial Lengkap Membuat Aplikasi Mobile dengan Flutter",
    tags: ["Flutter", "Mobile Development", "Dart", "Tutorial", "App Development"],
    cover: "https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=800&q=80&auto=format",
    minutes: 25,
    summary: "Panduan step-by-step membuat aplikasi mobile cross-platform dengan Flutter. Dari instalasi hingga deployment ke app store.",
    alt: "Flutter mobile app development",
    links: ["setup-vscode-web-development-panduan-lengkap", "panduan-lengkap-belajar-python-untuk-pemula", "panduan-karir-developer-2025"]
  },
  {
    slug: "perlombaan-antariksa-generasi-baru",
    published: "2025-09-24",
    category: "news",
    title: "Perlombaan Antariksa Generasi Baru: SpaceX vs Blue Origin",
    tags: ["SpaceX", "Blue Origin", "Antariksa", "Teknologi", "Space"],
    cover: "https://images.unsplash.com/photo-1446776877081-d282a0f896e2?w=800&q=80&auto=format",
    minutes: 12,
    summary: "Analisis mendalam persaingan antar perusahaan antariksa swasta dalam mengembangkan teknologi roket dan misi luar angkasa.",
    alt: "Roket SpaceX dan Blue Origin",
    links: ["era-baru-sinema-ai-sora", "revolusi-energi-hijau-baterai-solid-state", "dampak-jangka-panjang-remote-work"]
  },
  {
    slug: "revolusi-energi-hijau-baterai-solid-state",
    published: "2025-09-23",
    category: "news",
    title: "Revolusi Energi Hijau: Baterai Solid State 2025",
    tags: ["Energi Hijau", "Baterai", "Teknologi", "Sustainability", "Electric Vehicle"],
    cover: "https://images.unsplash.com/photo-1497435334941-8c899ee9e8e9?w=800&q=80&auto=format",
    minutes: 14,
    summary: "Teknologi baterai solid state yang revolusioner mengubah masa depan kendaraan listrik dan penyimpanan energi terbarukan.",
    alt: "Baterai solid state untuk energi hijau",
    links: ["perlombaan-antariksa-generasi-baru", "era-baru-sinema-ai-sora", "dampak-jangka-panjang-remote-work"]
  },
  {
    slug: "dampak-jangka-panjang-remote-work",
    published: "2025-09-22",
    category: "news",
    title: "Dampak Jangka Panjang Remote Work pada Ekonomi Global",
    tags: ["Remote Work", "Ekonomi", "Global", "Produktivitas", "WFH"],
    cover: "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&q=80&auto=format",
    minutes: 16,
    summary: "Analisis mendalam dampak jangka panjang remote work pada ekonomi global dan transformasi dunia kerja.",
    alt: "Remote work dan dampak ekonomi global",
    links: ["panduan-lengkap-setup-home-office-remote-work", "era-baru-sinema-ai-sora", "panduan-karir-developer-2025"]
  },
  {
    slug: "panduan-karir-developer-2025",
    published: "2025-09-15",
    category: "tutorial",
    title: "Panduan Karir Developer 2025: Roadmap Lengkap",
    tags: ["Karir", "Developer", "Programming", "Tutorial", "Roadmap"],
    cover: "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&q=80&auto=format",
    minutes: 22,
    summary: "Roadmap lengkap memulai karir sebagai developer di 2025. Panduan skill, tools, dan langkah-langkah menjadi programmer profesional.",
    alt: "Karir developer dan roadmap programming",
    links: ["setup-vscode-web-development-panduan-lengkap", "panduan-lengkap-belajar-python-untuk-pemula", "cara-membuat-website-dengan-chatgpt-ai-tools"]
  },
  {
    slug: "panduan-keamanan-siber-2025",
    published: "2025-09-18",
    category: "tutorial",
    title: "Panduan Keamanan Siber 2025: Perlindungan Digital",
    tags: ["Keamanan", "Siber", "Cybersecurity", "Tutorial", "Digital"],
    cover: "https://images.unsplash.com/photo-1563013544-824ae1b704d3?w=800&q=80&auto=format",
    minutes: 19,
    summary: "Panduan komprehensif keamanan siber untuk melindungi data dan privasi digital di era teknologi modern.",
    alt: "Keamanan siber dan perlindungan digital",
    links: ["panduan-karir-developer-2025", "setup-vscode-web-development-panduan-lengkap", "panduan-lengkap-belajar-python-untuk-pemula"]
  },
  {
    slug: "tips-optimasi-android-terbaru",
    published: "2025-09-16",
    category: "tutorial",
    title: "Tips Optimasi Android Terbaru 2025",
    tags: ["Android", "Optimasi", "Mobile", "Tutorial", "Tips"],
    cover: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=800&q=80&auto=format",
    minutes: 14,
    summary: "Tips dan trik optimasi performa Android untuk pengalaman mobile yang lebih smooth dan responsif.",
    alt: "Optimasi Android dan performa mobile",
    links: ["panduan-karir-developer-2025", "tutorial-lengkap-membuat-aplikasi-mobile-flutter", "panduan-lengkap-setup-home-office-remote-work"]
  },
  {
    slug: "setup-home-office-ergonomis",
    published: "2025-09-14",
    category: "tutorial",
    title: "Setup Home Office Ergonomis untuk Produktivitas Maksimal",
    tags: ["Home Office", "Ergonomis", "Produktivitas", "WFH", "Setup"],
    cover: "https://images.unsplash.com/photo-1497435334941-8c899ee9e8e9?w=800&q=80&auto=format",
    minutes: 16,
    summary: "Panduan setup home office yang ergonomis dan nyaman untuk meningkatkan produktivitas kerja dari rumah.",
    alt: "Setup home office ergonomis",
    links: ["panduan-lengkap-setup-home-office-remote-work", "dampak-jangka-panjang-remote-work", "panduan-karir-developer-2025"]
  },
  {
    slug: "panduan-laptop-gaming-2025",
    published: "2025-09-17",
    category: "tutorial",
    title: "Panduan Memilih Laptop Gaming Terbaik 2025",
    tags: ["Gaming", "Laptop", "Hardware", "Tutorial", "Review"],
    cover: "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=800&q=80&auto=format",
    minutes: 18,
    summary: "Panduan lengkap memilih laptop gaming terbaik dengan spesifikasi optimal untuk gaming modern.",
    alt: "Laptop gaming dan hardware gaming",
    links: ["panduan-karir-developer-2025", "setup-vscode-web-development-panduan-lengkap", "tips-optimasi-android-terbaru"]
  }
];

// Generate all possible tag slugs from actual articles
export function getStaticPaths() {
  // Define articles data here for getStaticPaths
  const articlesData = [
    {
      slug: "setup-vscode-web-development-panduan-lengkap",
      tags: ["VSCode", "Web Development", "Setup", "Tutorial", "Tools"]
    },
    {
      slug: "cara-membuat-website-dengan-chatgpt-ai-tools",
      tags: ["ChatGPT", "AI Tools", "Web Development", "Tutorial", "Website"]
    },
    {
      slug: "optimasi-chatgpt-panduan-prompts",
      tags: ["AI", "ChatGPT", "Prompt Engineering"]
    },
    {
      slug: "era-baru-sinema-ai-sora",
      tags: ["AI", "Sora", "Generative Video", "Teknologi"]
    },
    {
      slug: "panduan-lengkap-belajar-python-untuk-pemula",
      tags: ["Python", "Programming", "Tutorial", "Pemula", "AI"]
    },
    {
      slug: "panduan-lengkap-setup-home-office-remote-work",
      tags: ["Remote Work", "Home Office", "Produktivitas", "WFH", "Ergonomis"]
    },
    {
      slug: "tutorial-lengkap-membuat-aplikasi-mobile-flutter",
      tags: ["Flutter", "Mobile Development", "Dart", "Tutorial", "App Development"]
    },
    {
      slug: "perlombaan-antariksa-generasi-baru",
      tags: ["SpaceX", "Blue Origin", "Antariksa", "Teknologi", "Space"]
    },
    {
      slug: "revolusi-energi-hijau-baterai-solid-state",
      tags: ["Energi Hijau", "Baterai", "Teknologi", "Sustainability", "Electric Vehicle"]
    },
    {
      slug: "dampak-jangka-panjang-remote-work",
      tags: ["Remote Work", "Ekonomi", "Global", "Produktivitas", "WFH"]
    }
  ];
  
  const allTags = new Set();
  
  // Collect all unique tags from articles
  articlesData.forEach(article => {
    if (article.tags && Array.isArray(article.tags)) {
      article.tags.forEach(tag => {
        allTags.add(slugifyTag(tag));
      });
    }
  });
  
  // Generate paths for each tag
  return Array.from(allTags).map(tag => ({
    params: { tag }
  }));
}

const { tag } = Astro.params;
const tagParam = tag ?? "";

// Normalize tag parameter
const slugTarget = slugifyTag(tagParam);

// Filter articles by tag with defensive handling
const filteredArticles = ARTICLES.filter(article => {
  let tags = article.tags;
  
  // Handle string tags defensively with multiple delimiters
  if (typeof tags === 'string') {
    tags = tags.split(/[,;|/]/).map(t => t.trim()).filter(t => t);
  }
  
  // Handle null/undefined tags
  if (!Array.isArray(tags)) {
    tags = [];
  }
  
  // Check if any tag matches the target slug using isTagMatch utility
  return tags.some(tagName => isTagMatch(tagParam, tagName));
});

// Sort articles by publish date (newest first)
const sortedArticles = filteredArticles.sort((a, b) => 
  new Date(b.published).getTime() - new Date(a.published).getTime()
);

// Generate title and description with proper capitalization
const tagDisplayName = tagParam.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
const title = `Artikel dengan Tag: ${tagDisplayName} — Maneh`;
const description = `Kumpulan artikel dengan tag "${tagDisplayName}" dari Maneh. Tutorial dan tips teknologi terlengkap dengan bahasa sederhana.`;

// Generate article URLs
const articlesWithUrls = sortedArticles.map(article => {
  const date = new Date(article.published);
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  
  // Get order number based on category and published date
  const categoryArticles = ARTICLES.filter(art => art.category === article.category)
    .sort((a, b) => new Date(b.published).getTime() - new Date(a.published).getTime());
  const order = categoryArticles.findIndex(art => art.slug === article.slug) + 1;
  
  const articleUrl = `/${year}/${month}/${day}/${order}-${article.slug}`;
  
  return {
    ...article,
    url: articleUrl
  };
});
---

<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>{title}</title>
  <meta name="description" content={description}>
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content={`https://maneh.blog/tag/${slugTarget}`}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&h=630&auto=format&fit=crop&crop=center">
  <meta property="og:site_name" content="Maneh">
  <meta property="og:locale" content="id_ID">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content={`https://maneh.blog/tag/${slugTarget}`}>
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&h=630&auto=format&fit=crop&crop=center">
  
  <!-- Canonical URL -->
  <link rel="canonical" href={`https://maneh.blog/tag/${slugTarget}`}>
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/style.css?v=1.4" type="text/css">
</head>
<body>
  <main class="container">
    <section class="page">
      <header>
        <h1>Artikel dengan Tag: {tagDisplayName}</h1>
        <p class="tag-description">{description}</p>
        <p class="tag-count">Ditemukan {sortedArticles.length} artikel</p>
      </header>
      
      {sortedArticles.length > 0 ? (
        <div class="articles-list">
          {articlesWithUrls.map(article => (
            <article class="card">
              <a href={article.url} data-slug={article.slug}>
                <img 
                  class="thumb" 
                  loading="lazy" 
                  decoding="async" 
                  src={article.cover} 
                  alt={article.title}
                  onerror="this.src='https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&h=630&auto=format&fit=crop&crop=center'; this.onerror=null;"
                >
                <div class="h2">{article.title}</div>
                <div class="meta">
                  <time datetime={article.published}>
                    {new Date(article.published).toLocaleDateString('id-ID', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </time>
                </div>
                <p class="desc">{article.summary}</p>
                {article.tags && article.tags.length > 0 && (
                  <div class="tags">
                    {article.tags.map(tag => (
                      <a href={getTagUrl(tag)} class="tag-item" rel="tag" data-tag={slugifyTag(tag)} aria-label={`Tag: ${tag}`}>
                        {tag}
                      </a>
                    ))}
                  </div>
                )}
              </a>
            </article>
          ))}
        </div>
      ) : (
        <div class="no-articles">
          <h2>Tag terkait '{tagDisplayName}' tidak ditemukan</h2>
          <p>Kami tidak menemukan artikel dengan tag ini. Berikut beberapa artikel terbaru yang mungkin menarik:</p>
          
          <!-- Show recommended articles -->
          <div class="recommended-articles">
            {ARTICLES.slice(0, 6).map(article => {
              const date = new Date(article.published);
              const year = date.getFullYear();
              const month = String(date.getMonth() + 1).padStart(2, '0');
              const day = String(date.getDate()).padStart(2, '0');
              
              // Get order number based on category and published date
              const categoryArticles = ARTICLES.filter(art => art.category === article.category)
                .sort((a, b) => new Date(b.published).getTime() - new Date(a.published).getTime());
              const order = categoryArticles.findIndex(art => art.slug === article.slug) + 1;
              
              const articleUrl = `/${year}/${month}/${day}/${order}-${article.slug}`;
              
              return (
                <article class="card recommended-card">
                  <a href={articleUrl} data-slug={article.slug}>
                    <img 
                      class="thumb" 
                      loading="lazy" 
                      decoding="async" 
                      src={article.cover} 
                      alt={article.title}
                      onerror="this.src='https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&h=630&auto=format&fit=crop&crop=center'; this.onerror=null;"
                    >
                    <div class="h2">{article.title}</div>
                    <div class="meta">
                      <time datetime={article.published}>
                        {new Date(article.published).toLocaleDateString('id-ID', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric'
                        })}
                      </time>
                    </div>
                    <p class="desc">{article.summary}</p>
                  </a>
                </article>
              );
            })}
          </div>
          
          <p><a href="/">← Kembali ke beranda</a></p>
        </div>
      )}
    </section>
  </main>
  
  <!-- Fallback script for hash-based navigation -->
  <script>
    // Handle hash-based tag navigation for backward compatibility
    (function() {
      const hash = window.location.hash;
      if (hash && hash.startsWith('#tag/')) {
        const tagSlug = hash.replace('#tag/', '');
        console.info('Hash-based tag navigation detected, redirecting to:', `/tag/${tagSlug}`);
        window.location.replace(`/tag/${tagSlug}`);
      }
    })();
  </script>
  
  <style>
    .no-articles {
      text-align: center;
      padding: 2rem;
      color: var(--muted);
    }
    
    .no-articles h2 {
      color: var(--heading);
      margin-bottom: 1rem;
    }
    
    .no-articles p {
      margin-bottom: 1rem;
    }
    
    .no-articles a {
      color: var(--brand1);
      text-decoration: none;
      font-weight: 600;
    }
    
    .no-articles a:hover {
      text-decoration: underline;
    }
    
    .recommended-articles {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
      text-align: left;
    }
    
    .recommended-card {
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      overflow: hidden;
      transition: var(--transition);
    }
    
    .recommended-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: var(--brand1);
    }
    
    .recommended-card a {
      display: block;
      text-decoration: none;
      color: inherit;
    }
    
    .recommended-card .thumb {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    
    .recommended-card .h2 {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--title-text);
      margin: 1rem 1rem 0.5rem 1rem;
      line-height: 1.3;
    }
    
    .recommended-card .meta {
      margin: 0 1rem 0.75rem 1rem;
      font-size: 0.875rem;
      color: var(--muted);
    }
    
    .recommended-card .desc {
      margin: 0 1rem 1rem 1rem;
      color: var(--desc-text);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    @media (max-width: 768px) {
      .recommended-articles {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }
  </style>
</body>
</html>
